* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) on Feb, 08. 2013.
* INPUT FILES FOR EQUILIBRATION
*

bomlev -3

DIMENS CHSIZE 1000000

set type = om

set dir = /share/ceph/woi216group/yag218/opa60/@type/@sys/sys_1
set trjdir = /share/ceph/woi216group/yag218/opa60/@type/analysis/centering/@sys

! Read topology and parameter files
stream ../toppar.str

! Read PSF and Coordinates
open read unit 10 card name @dir/step5_assembly.psf
read psf  unit 10 card

open read unit 10 card name @dir/step5_assembly.crd
read coor unit 10 card

! Read the system information
stream @dir/step5_assembly.str

!
! Image Setup
!

open read unit 10 card name ../crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD

!Image centering by residue
IMAGE BYSEGID XCEN 0.0 YCEN 0.0 ZCEN 0.0 sele ( segid  L* .or. segid  T* .or. segid  F* .or. segid  Z* ) end
IMAGE BYSEGID XCEN 0.0 YCEN 0.0 ZCEN 0.0 sele segid PROA end
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN 0.0 sele segid MEMB end
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN 0.0 sele resname TIP3 end
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN 0.0 sele resname CAL .or. resname POT .or. resname CLA end

set 0 = @sys
set 1 = @type
!system "python checkfft.py ?XTLA ?XTLB ?XTLC > checkfft-@1-@0.str"
stream "checkfft-@1-@0.str"

!
! Nonbonded Options[short distances and no pme just for image centering]
!

nbonds atom vatom vfswitch bycb -
       ctonnb 4.0 ctofnb 5.0 cutnb 6.0 cutim 6.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 -
!       ewald pmew fftx @fftx ffty @ffty fftz @fftz  kappa .34 spline order 6
energy

define tail1 sele -
                 ( resname *LIP* .and. ( type C1* .or. type C2* .or. type C3* .or. -
                   type C5* .or. type C6* .or. type C7*  ) .and. .not. ( type C+1  -
                   .or. type C+2 .or. type C+3 ) .or. ( type C22 .or. type C23 .or. -
                   type C62 .or. type C63 ) ) show end

define tail2 sele ( ( resname PPPE .or. resname PVPG ) -
                   .and. ( type C2* .or. type C3* ) .and. .not. (  -
                   type C+1 .or. type C2 .or. type C3 ) ) show end

define tail3 sele ( ( resname PVCL2 ) .and. ( type CA* .or. type CB* .or. type CC* .or. type CD* ) -
                  .and. .not. ( type C%1 ) ) show end

define lpstail sele tail1 end
define pltail sele tail2 .or. tail3 end

define PAB sele ( resname *LIP* .and. type PA .or. type PB ) show end
define P2 sele (segid MEMB .and. ( type P .or. type P1 .or. type P3 ) ) show end

define PO4 sele PAB .or. P2 end

define lpshead sele ( resname *LIP* .and. ( type PA .or. type PB .or. type CA+ -
                .or. type CB+ .or. type OPA+ .or. type OPB+ .or. type OB+ -
                .or. type OA+ ) ) show end

define bht sele resname *LIPA .and. .not. lpshead .and. .not. tail1 show end

define plhead1 sele ( resn PPPE .or. resn PVPG ) .and. -
                 ( type P .or. type N .or. type C1+ .or. type O1+ .or. type OC+) show end
define plhead2 sele ( resn PVCL2 ) .and. -
           ( type P+ .or. type OP1+ .or. type OP3+ .or. type OG12 .or. type C+ ) show end

define plhead sele plhead1 .or. plhead2 show end

define COO sele ( resname AKDO .and. type C1 ) show end

define carbonyl1 sele ( resname *LIP* ) .and. ( type C+1 .or. type O+1 ) show end

define carbonyl2 sele ( resname PPPE .or. resname PVPG ) -
                       .and. ( type C21 .or. type O22 -
                      .or. type C31 .or. type O32 ) show end
define carbonyl3 sele ( resname PVCL2 ) .and. ( type C%1 .or. type O%1 ) .and. -
               .not. (type C+1 .or. type O+1) show end

define carbonyl sele carbonyl1 .or. carbonyl2 .or. carbonyl3 show end

define kdo    sele ( segid LP* .and. resid 2:3  .and. .not. hydrogen ) end
define incor0 sele ( segid LP* .and. resid 4:6  .and. .not. hydrogen ) end
define incor  sele ( segid LP* .and. resid 2:6  .and. .not. hydrogen ) end
define outcor  sele ( segid LP* .and. resid 7:11  .and. .not. hydrogen ) end

define wat sele ( resn TIP3 .and. type O* ) end

define CH3 sele ( resname *LIP* .and. ( type C114 .or. type C212 .or. type C312 -
                                   .or. type C514 .or. type C612 .or. type C712 ) ) end

define CAL sele ( segid CAL ) end
define POT sele ( segid POT ) end
define CLA sele ( segid CLA ) end

define last1 sele ( resname *LIP* .and. ( type C114 .or. type C212 .or. type C312 -
                                   .or. type C514 .or. type C612 .or. type C712 ) ) end

define last2 sele ( type C316 .or. type C216 ) .and. resn PPPE -
          .and. ( type C316 .or. type C218 ) .and. resn PVPG -
          .and. ( type CB16 .or. type CA18 .or. type CD16 .or. type CC18 ) .and. resn PVCL2 end

define PROT sele segid PROA end
define bb   sele ( type C .or. type O .or. type N  .or. type CA ) .and. PROT end
define loop1 sele resid  16 :  54 .and. BB .and. PROT end
define loop2 sele resid  72 : 114 .and. BB .and. PROT end
define loop3 sele resid 143 : 190 .and. BB .and. PROT end
define loop4 sele resid 213 : 229 .and. BB .and. PROT end

!
! Trajectory analysis (number of trajectory: @maxcnt)
!

calc cntmin = 2501
calc cntmax = 3000

calc cnt = @cntmin
calc unit    = 11

open write unit 8 card name @{local}/@type_@sys_@resid_in.dat
open write unit 9 card name @{local}/@type_@sys_@resid_out.dat

label opentrj

   open read unit @unit file name @trjdir/step7_cent_@cnt.dcd

   traj query unit 11

    calc nfile = ?NFILE
    calc start = ?start
    calc skip  = ?skip

   calc nfile = 10
   traj iread 11 nread 1 begin @start

   calc cmt = 1
   label readtrj

      traj read

      coor stat sele PROT .and. .not. type H* end
      calc xmin = ?xmin - 8
      calc ymin = ?ymin - 8
      calc zmin = ?zmin - 8
      calc xmax = ?xmax + 8
      calc ymax = ?ymax + 8
      calc zmax = ?zmax + 8

      define neib sele .not. ( PROT .or. type H* ) .and. -
                             ( prop X .le. @xmax .and. prop X .gt. @xmin ) .and. -
                             ( prop Y .le. @ymax .and. prop Y .gt. @ymin ) .and. -
                             ( prop Z .le. @zmax .and. prop Z .gt. @zmin ) end
     ! interact with water
      coor dist cut 4 sele resid @resid .and. PROT .and. .not. type H* end -
                      sele wat .and. neib end
      set count1 0
      if ?npair .gt. 0 set count1 1

     ! interact with plhead
      coor dist cut 4 sele resid @resid .and. PROT .and. .not. type H* end -
                      sele plhead .and. neib end
      set count2 0
      if ?npair .gt. 0 set count2 1

     ! interact with pltail
      coor dist cut 4 sele resid @resid .and. PROT .and. .not. type H* end -
                      sele pltail .and. neib end
      set count3 0
      if ?npair .gt. 0 set count3 1

     ! interact with lpshead
      coor dist cut 4 sele resid @resid .and. PROT .and. .not. type H* end -
                      sele lpshead .and. neib end
      set count4 0
      if ?npair .gt. 0 set count4 1

     ! interact with lpstail
      coor dist cut 4 sele resid @resid .and. PROT .and. .not. type H* end -
                      sele lpstail .and. neib end
      set count5 0
      if ?npair .gt. 0 set count5 1

     ! interact with bht
      coor dist cut 4 sele resid @resid .and. PROT .and. .not. type H* end -
                      sele bht .and. neib end
      set count6 0
      if ?npair .gt. 0 set count6 1

     ! interact with kdo
      coor dist cut 4 sele resid @resid .and. PROT .and. .not. type H* end -
                      sele kdo .and. neib end
      set count7 0
      if ?npair .gt. 0 set count7 1

     ! interact with incor0
      coor dist cut 4 sele resid @resid .and. PROT .and. .not. type H* end -
                      sele incor0 .and. neib end
      set count8 0
      if ?npair .gt. 0 set count8 1

     ! interact with incor
      coor dist cut 4 sele resid @resid .and. PROT .and. .not. type H* end -
                      sele incor .and. neib end
      set count9 0
      if ?npair .gt. 0 set count9 1

     ! interact with outcor
      coor dist cut 4 sele resid @resid .and. PROT .and. .not. type H* end -
                      sele outcor .and. neib end
      set count10 0
      if ?npair .gt. 0 set count10 1

      write title unit 8
      * @count1 @count2 @count3 @count4 @count5
      *

      write title unit 9
      * @count6 @count7 @count8 @count9 @count10
      *

   incr cmt by 1
   if cmt .le. @nfile goto readtrj

incr cnt by 1
if cnt .le. @cntmax goto opentrj

stop
