* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) on Jul, 17. 2009.
* INPUT FILES FOR EQUILIBRATION
*

DIMENS CHSIZE 3000000

set posid = POT
set negid = CLA

! Read topology and parameter files
stream ./toppar.str

!Read the system information
stream ./step5_assembly.str

! Read PSF and Coordinates
open read unit 10 card name ./step5_assembly.psf
read psf  unit 10 card

open read unit 10 card name ./step5_assembly.crd
read coor unit 10 card

!
! Image Setup
!

open read unit 10 card name ./crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD

!Image centering by residue
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele resname TIP3 .or. segid MEMB end
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele resname @posid .or. resname @negid end
IMAGE BYSEGID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele segid PRO* end

!
! Nonbonded Options [short distances and no pme just for image centering]
!

nbonds atom vatom vfswitch bycb -
       ctonnb 4.0 ctofnb 5.0 cutnb 6.0 cutim 6.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 !-       ewald pmew fftx @fftx ffty @ffty fftz @fftz  kappa .34 spline order 6
!energy

!
! Trajectory analysis (number of trajectory: @cntmax)
!

open write unit 22 unform name ./recen.dcd

open read unit 11 file name ./anton/trpv2-1_500ns.dcd

   traj query unit 11
   calc start = ?start
   calc skip  = ?skip
   calc nfile = ?NFILE

   traj firstu 11 nunit 1 skip @skip begin 0 stop @nfile iwrite 22
   !traj iread 11 begin 0 stop 417 iwrite 22 nfile 1
   !traj iread 11 iwrite 22 nread 1 begin @start skip @skip

calc cmt = 1
label readtrj

   traj read

   !centering 1
   coor stat mass sele ( ( segid MEMB ) .and. resid 1 ) end
   coor trans zdir -?zave
   energy

   !centering 2
   coor stat mass sele ( segid MEMB ) .and. .not. hydrogen end
   coor trans zdir -?zave
   energy

   coor stat mass sele segid PROD .and. .not. hydrogen end
   coor trans xdir -?xave ydir -?yave
   energy

   coor stat mass sele segid PRO* .and. .not. hydrogen end
   coor trans xdir -?xave ydir -?yave
   energy

   traj write

   increase cmt  by 1

!if cmt .le. 5 goto readtrj
if cmt .le. @nfile goto readtrj


stop
