* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) on Jul, 17. 2009.
* INPUT FILES FOR EQUILIBRATION
*

DIMENS CHSIZE 3000000

!bomlev -5

!debug

set trjdir = /home/shf317/workdir/small-v2/namd
set outdir = /home/shf317/workdir/small-v2/analysis
set posid = POT
set negid = CLA
set segid = PRO*

! Read topology and parameter files
stream toppar.str

!Read the system information
stream @trjdir/../step5_assembly.str

! Read PSF and Coordinates
open read unit 10 card name @trjdir/../step5_assembly.psf
read psf  unit 10 card

open read unit 10 card name @trjdir/../step5_assembly.crd
read coor unit 10 card

!
! Image Setup
!

open read unit 10 card name @trjdir/../crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD

!Image centering by residue
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele resname TIP3 .or. segid MEMB end
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele resname @posid .or. resname @negid end
IMAGE BYSEGID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele segid PRO* end

!
! Nonbonded Options [short distances and no pme just for image centering]
!

nbonds atom vatom vfswitch bycb -
       ctonnb 4.0 ctofnb 5.0 cutnb 6.0 cutim 6.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 !-       ewald pmew fftx @fftx ffty @ffty fftz @fftz  kappa .34 spline order 6
!energy

!
! Trajectory analysis (number of trajectory: @cntmax)
!

define proa sele segid @segid .and. .not. hydrogen show end

coor copy comp

set cntmin = 10
set cntmax = 20

calc cnt     = @cntmin
calc unit    = 11

open write unit 51 card name @outdir/n_rmsd_trpv2_@cntmax.plo

calc tcnt    = (@cnt-1)*100

label opentrj

   open read unit @unit file name @trjdir/step7.@{cnt}_production.dcd
   traj query unit 11
   calc start = ?start
   calc skip  = ?skip
   calc nfile = ?NFILE

   traj iread 11 nread 1 begin @start skip @skip

   calc cmt = 1
   label readtrj

      traj read

      calc time = @tcnt * 0.01  ! ns

      !centered about the origin (center of mass) and then rotated to align with the axis
      coor orient rms sele ( segid pro* .and. resid 76:729 ) end
      set rms_a = ?rms

      write title unit 51
      * @time @{rms_a}
      *

      !stop

      increase tcnt by 1
      increase cmt  by 1

   if cmt .le. @nfile goto readtrj

   !debug
   !stop
   
   increase cnt by 1
if cnt .le. @cntmax goto opentrj

stop
