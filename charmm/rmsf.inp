* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) on Feb, 08. 2013.
* INPUT FILES FOR EQUILIBRATION
* INPUT FILES FOR RMSF ANALYSIS, FROM Joonseong, DATE 7/17/2017
*

DIMENS CHSIZE 1000000																		
!set trjdir =  
set outdir = ./rmsf
set posid = POT
set negid = CLA 

! Read topology and parameter files
stream @outdir/toppar_modify.str																																			
! LOAD topology file, read topology and parameter for different lipid, protein, carbohydrate etc.

! Read the system information
stream /home/shf317/charmm-gui/step5_assembly.str									

! Read PSF and Coordinates
! Here he has set sys, nsys these 2 variable
open read unit 10 card name /home/shf317/charmm-gui/step5_assembly.psf						
read psf  unit 10 card

! It's easy to understand step5_assembly.psf and .crd are used to provide structure and coordinates.
open read unit 10 card name /home/shf317/charmm-gui/step5_assembly.crd		
read coor unit 10 card


!
! Image Setup
!

open read unit 10 card name /home/shf317/charmm-gui/crystal_image.str								
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD

!Image centering by residue																	
IMAGE BYSEGID XCEN 0.0 YCEN 0.0 ZCEN 0.0 sele segid PROA end     
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN 0.0 sele segid MEMB end
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN 0.0 sele resname TIP3 end
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN 0.0 sele resname POT .or. resname CLA end

!
! Nonbonded Options[short distances and no pme just for image centering]
!

nbonds atom vatom vfswitch bycb -
       ctonnb 4.0 ctofnb 5.0 cutnb 6.0 cutim 6.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 !-
      ! ewald pmew fftx @fftx ffty @ffty fftz @fftz  kappa .34 spline order 6				
! energy																						
!set bomlev -3

!
! Define
!


!CA
DEFINE CA  sele segid PROA  .and. type CA end													

!BackBone
DEFINE BB  sele segid PROA .and. -
           (type N .or. type CA .or. type C .or. type O .or. type OT*) end					

!SideChain
DEFINE SC  sele segid PROA .and. .not. (BB .or. Hydrogen) end								
bomlev -1

COOR STAT sele segid PROA end         													

open write card unit 51 name @outdir/rmsf_br_100.plo         							

!
! Trajectory analysis (number of trajectory: @maxcnt)
!

! rmsf
coor copy comp																			

calc cnt  = 1																			
calc cntmax  = 100
calc ndcd  = @cntmax - @cnt + 1
calc unit  = 101

label opentrj																				
   open read unit @unit file name @trjdir/step7.@cnt_production.dcd					
   increase unit by 1																			
   increase cnt by 1																		
if cnt .le. @cntmax goto opentrj															

traj iread 101 nread @ndcd skip 1
traj query unit 101											
! ALL
coor dyna noprint firstu 101 nunits @ndcd orient sele segid PROA .and. .not. hydrogen end  sele BB end																		

scalar wmain POW2r

scalar wmain average byresidue sele BB  end													
scalar wmain average byresidue sele SC  end													
scalar wmain sqrt  sele prop wmain .gt. 0.0 end                                             

coor stat sele segid PROA .and. type CA end														
calc firstres = ?SELRESI																
calc lastres  = ?SELRESI + ?NSEL - 1														
calc i = @firstres

label dowrite1																				
   coor state sele segid PROA .and. resid @i .and. BB show end									
   calc bb =  ?wave																			

   write title unit 51
   * @i @bb
   *
   increas i by 1
if i .le. @lastres goto dowrite1

stop
