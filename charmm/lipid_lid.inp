* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) v2.0 on Apr, 26. 2014.
* ASSEMBLE PREVIOUSLY GENERATED COMPONENTS
*

DIMENS CHSIZE 1000000

!prnlev 5
! Read topology and parameter files
stream toppar.str

bomlev -1

set lipid = pgar

read sequence @lipid 1
generate MEMB setup warn

ic generate
ic param
ic seed 1 C1 1 C2 1 C3
ic build
define tmp sele .not. init show end
if ?nsel gt 0 stop

hbuild sele hydrogen end
coor copy comp

coor orient sele type O* .or. type C1 .or. type C2 .or. type C3 show end
coor rotate ydir 1.0 phi -90
coor state sele type O* end
coor trans zdir -?zave
coor state sele type O* end
coor state
if ?zave .gt. 0 coor rotate ydir 1.0 phi 180
coor print

!
! Restraints for lipids
!

set NLIPID = 1

set tforce =  5.0   ! force constant to keep the lipid tail below +/- %
set mforce =  5.0   ! force constant to keep the lipid head groups close to target values

stream membrane_lipid_restraint.str

MMFP
GEO reset
END

set fcis   =   250  ! dihedral restraint force constant to keep the cis double bonds
set fc2    =   250  ! dihedral restraint force constant to keep the c2  chirality

stream membrane_lipid_restraint2.str

set rcyln = 5.0
if iscl .eq. ok set rcyln = 8.0

MMFP
GEO cylinder -
    Xref 0.0 Yref 0.0 Zref 0.0 XDIR 0.0 YDIR 0.0 ZDIR 1.0 -
    harmonic FORCE 5.0 droff @rcyln select .not. hydrogen end
END

MMFP
GEO plane -
    xref 0.0 yref 0.0 zref -@zpostop zdir 1.0 -
    harmonic inside  force @tforce droff 2.5 select TAIL show end
END

MMFP
GEO rcm cylinder -
    Xref 0.0 Yref 0.0 Zref 0.0 XDIR 0.0 YDIR 0.0 ZDIR 1.0 -
    harmonic FORCE 25.0 select HEAD end
END

MMFP
GEO rcm plane -
    Xref 0.0 Yref 0.0 Zref 0.0 XDIR 0.0 YDIR 0.0 ZDIR 1.0 -
    harmonic FORCE 25.0 select HEAD end
END

!
! Run Langevin dynamics
!

!Note eps=80, truncation at 10 Angstrom
nbonds atom switch vatom vswitch -
       ctonnb 50.0 ctofnb 50.0 cutnb 100.0 cutim 100.0 -
       inbfrq -1 imgfrq -1 wmin 0.1 cdie eps 80.0

mini sd   nstep 50
mini abnr nstep 50

calc nstep = 5000
calc temp  = 323.15
shake bonh param fast
scalar fbeta set 5.0 select .not. type H* end

calc tcnt = 1
label dolang

   DYNA LANGEVIN -
        start         nstep  @nstep  timestp 0.002  echeck -1 -
        inbfrq    -1  imgfrq     -1  ihbfrq      0  ilbfrq      0 -
        firstt @temp  finalt  @temp  tstruc  @temp  -
        tbath  @temp  rbuf      0.0  -
        iunread   -1  iunwrite   -1  iuncrd     -1  iunvelo    -1 -
        nsavc   5000  nsavvelo    0  -
        nprint  1000  iprfrq   1000  isvfrq   1000  ntrfrq   5000 -
        iasvel     1

   if tcnt .le. 1000 then
      set Lipdir = conf1
      calc NNN = @tcnt
   else
      set Lipdir = conf2
      calc NNN = @tcnt - 1000
   endif

   open write unit 10 card name lipid_lib/@lipid/@Lipdir/@lipid_@NNN.crd
   write coor unit 10 card

increase tcnt by 1
if tcnt .le. 2000  goto dolang

open write unit 10 card name junk_@lipid.pdb
write coor unit 10 pdb

stop
