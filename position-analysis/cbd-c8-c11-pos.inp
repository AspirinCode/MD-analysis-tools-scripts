* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) on Jul, 17. 2009.
* INPUT FILES FOR EQUILIBRATION
* INPUT FILES FOR hydrophobic thickness ANALYSIS, FROM Hongjing, Date 7/17/2017
*

DIMENS CHSIZE 3000000

!bomlev -5

!set trjdir = /home/shf317/charmm-gui/namd
!set outdir = ./analysis
set posid = POT
set negid = CLA

! Read topology and parameter files
stream ./toppar.str

!Read the system information
stream ../../step5.1_assembly.str

! Read PSF and Coordinates
open read unit 10 card name ../../step5.1_assembly.psf
read psf  unit 10 card

!read NAMD file "namd/step7.95_production.coor"
open read unit 10 card name ../../step5.1_assembly.crd
read coor unit 10 card

!
! Image Setup
!

open read unit 10 card name ../../crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD

!Image centering by residue
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele resname TIP3 .or. segid MEMB end
!IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele segid MEMB end
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele resname @posid .or. resname @negid .or. resname CAL end
IMAGE BYSEGID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele segid PRO* .or. segid HET* end

!
! Nonbonded Options [short distances and no pme just for image centering]
!

nbonds atom vatom vfswitch bycb -
       ctonnb 4.0 ctofnb 5.0 cutnb 6.0 cutim 6.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 !-       ewald pmew fftx @fftx ffty @ffty fftz @fftz  kappa .34 spline order 6
!energy

!
! Trajectory analysis (number of trajectory: @cntmax)
!

coor copy comp


open write unit 51 card name @local/C8-position-@timeseries.plo
open write unit 52 card name @local/C11-position-@timeseries.plo

!set cntmin = 1
!calc cntmax = 7 !@ns

calc cnt     = 1 ! @cntmin
calc unit    = 11

!calc tcnt    = 2084 !(@cnt-1)*100
set prnlev 0

!set traj1 =

label opentrj

   open read unit @unit file name ../rct-v2-lig-300k-@timeseries.dcd
   traj query unit @unit
   calc start = ?start
   calc skip  = ?skip
   calc nfile = ?NFILE

   traj firstu 11 nunit 1 skip @skip begin @start stop @nfile
   !traj iread 11 nread 1 begin @start skip @skip

   calc cmt = 1
   label readtrj

      traj read

      calc time = @tcnt * 0.24  ! ns

      !!centering 1
      !coor stat mass sele ( ( segid MEMB ) .and. resid 1 ) end
      !coor trans zdir -?zave
      !energy

      !!centering 2
      !coor stat mass sele ( segid MEMB ) .and. .not. hydrogen end
      !coor trans zdir -?zave
      !energy

      !define UPPER select ( (resn POPC .or. resn POPE ) .and. type C2) .and. -
      !                      prop z .gt. 0 end
      !define LOWER select (  (resn POPC .or. resn POPE .or. resn SAPI14 ) .and. type C2) -
      !                      .and. prop z .lt. 0 end

      quick sele atom heta 1001 C11 end
      calc a = ?ZVAL

      quick sele atom hetb 1001 C11 end
      calc b = ?ZVAL

      quick sele atom hetc 1001 C11 end
      calc c = ?ZVAL

      quick sele atom hetd 1001 C11 end
      calc d = ?ZVAL
      
      
      quick sele atom heta 1001 C8 end
      calc e = ?ZVAL

      quick sele atom hetb 1001 C8 end
      calc f = ?ZVAL

      quick sele atom hetc 1001 C8 end
      calc g = ?ZVAL

      quick sele atom hetd 1001 C8 end
      calc h = ?ZVAL

      write title unit 51
      * @time @e @f @g @h
      *

      write title unit 52
      * @time @a @b @c @d
      *

      !write title unit 51
      !* @{time} @{zea} @{za} @{zeb} @{zb} @{zec} @{zc} @{zed} @{zd}
      !*

      increase tcnt by 1
      increase cmt  by 1

   if cmt .le. @nfile goto readtrj

   !debug
   !stop

   increase cnt   by 1
!if cnt .le. @cntmax goto opentrj

stop
