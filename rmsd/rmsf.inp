* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) on Jul, 17. 2009.
* INPUT FILES FOR EQUILIBRATION
*

DIMENS CHSIZE 3000000

!bomlev -5
!debug

set sysn = v2-apo-s1-300k
set outdir = @local 

set posid = POT
set negid = CLA
set segid = PROA

! Read topology and parameter files
stream toppar.str

!Read the system information
stream ../../step5.2_pene_resolved.str

! Read PSF and Coordinates
open read unit 10 card name ../../step5.2_pene_resolved.psf
read psf  unit 10 card

open read unit 10 card name ../../step5.2_pene_resolved.crd
read coor unit 10 card

!
! Image Setup
!

open read unit 10 card name ../../crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD

!Image centering by residue
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele resname TIP3 .or. segid MEMB end
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele segid @posid .or. segid @negid end
IMAGE BYSEGID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele segid PRO* .or. segid HET* end

!
! Nonbonded Options [short distances and no pme just for image centering]
!

nbonds atom vatom vfswitch bycb -
       ctonnb 4.0 ctofnb 5.0 cutnb 6.0 cutim 6.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 !-       ewald pmew fftx @fftx ffty @ffty fftz @fftz  kappa .34 spline order 6
!energy

!
! Trajectory analysis (number of trajectory: @cntmax) 
!

! A number of selections for later usage
!define prot sele segid pro* .and. .not. hydrogen show end
!define s1 sele segid pro* .and. resid 302 : 336 end
!define s2 sele segid pro* .and. resid 357 : 384 end
!define s3 sele segid pro* .and. resid 397 : 418 end
!define s4 sele segid pro* .and. resid 424 : 442 end
!define s5 sele segid pro* .and. resid 446 : 485 end
!define s6 sele segid pro* .and. resid 545 : 575 end

!CA
DEFINE CA  sele segid PRO*  .and. type CA end

!BackBone
DEFINE BB  sele segid PRO* .and. (type N .or. type CA .or. -
                 type C .or. type O .or. type OT*) end

!SideChain
DEFINE SC  sele segid PRO* .and. .not. (BB .or. Hydrogen) end

bomlev -1

coor copy comp

!set cntmin = 1
!set cntmax = 500

calc cnt    = 1 !@cntmin
calc unit   = 11

open write unit 51 card name @outdir/@sysn_rmsf_@timeseries.plo

!calc tcnt  = (@cnt-1)*100
calc tcnt   = 1

open read unit @unit file name ../v2-apo-s1-300k-@timeseries.dcd 
traj query unit 11
calc start = ?start
calc skip  = ?skip 
calc nfile = ?NFILE !use 10 fr each dcd

traj firstu 11 nunit 1 skip @skip begin @start stop @nfile
!traj iread 11 nread 1 begin @start skip 50000
traj query unit 11

coor dyna noprint firstu 11 nunits 1 begin @start skip @skip stop @nfile orient -
          sele segid PRO* .and. .not. hydrogen end -
          sele BB end

scalar wmain POW2r
scalar wmain average byresidue sele BB  end
scalar wmain average byresidue sele SC  end
scalar wmain sqrt  sele prop wmain .gt. 0.0 end

!coor stat sele segid PROA .and. type CA end
!calc firstres = 1 
!calc lastres  = 645 

calc segid = 1
label doseg

    ! Map to segname, residue length type
    ! proa/b/c/d: 1-645
    ! proe/f/g/h: 30-45
    if segid .eq. 1 then 
        set segname proa
        goto type1
    endif

    if segid .eq. 2 then
        set segname prob
        goto type1
    endif

    if segid .eq. 3 then 
        set segname proc
        goto type1
    endif

    if segid .eq. 4 then 
        set segname prod
        goto type1
    endif

    if segid .eq. 5 then
        set segname proe
        goto type2
    endif

    if segid .eq. 6 then
        set segname prof
        goto type2
    endif

    if segid .eq. 7 then
        set segname prog
        goto type2
    endif
    
    if segid .eq. 8 then
        set segname proh
        goto type2
    endif

    ! proa/b/c/d: 1-645
    label type1
        calc firstres = 1
        calc lastres  = 645
        goto initres

    ! proe/f/g/h: 30-45
    label type2
        calc firstres = 30
        calc lastres  = 45
        goto initres

    label initres
    calc resid  = @firstres
    label dores1
        coor state sele segid @segname .and. resid @resid .and. BB show end
        calc bb =  ?wave
        
        write title unit 51
        * @segname @resid @bb
        *

    increas resid by 1
    if resid .le. @lastres goto dores1    

incr segid by 1
if segid .le. 8 goto doseg 

stop



