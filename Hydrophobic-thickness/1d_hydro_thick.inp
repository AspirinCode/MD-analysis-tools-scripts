* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) on Jul, 17. 2009.
* INPUT FILES FOR EQUILIBRATION
* INPUT FILES FOR hydrophobic thickness ANALYSIS, FROM Hongjing, Date 7/17/2017
*

DIMENS CHSIZE 3000000

!bomlev -5

!debug
!set replica = 1
!charmm replica=1 < h_thick.inp
!charmm sysname=50_G1P_G3P ns=100 < hydro_thick.inp

!set trjdir = /home/shf317/charmm-gui/namd
!set outdir = /home/shf317/workdir/50_men8_pg_zw/analysis/
!set outdir = /home/shf317/workdir/analysis/arch_mem/
!set outdir = ./analysis
set posid = POT
set negid = CLA

! Read topology and parameter files
stream ./toppar.str

!Read the system information
stream ./step5_assembly.str

! Read PSF and Coordinates
open read unit 10 card name ./step5_assembly.psf
read psf  unit 10 card

!read NAMD file "namd/step7.95_production.coor"
open read unit 10 card name ./step5_assembly.crd
read coor unit 10 card

!
! Image Setup
!

open read unit 10 card name ./crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD

!Image centering by residue
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele resname TIP3 .or. segid MEMB end
!IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele segid MEMB end
IMAGE BYRESID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele resname @posid .or. resname @negid end
!IMAGE BYSEGID XCEN 0.0 YCEN 0.0 ZCEN @zcen sele segid PROA end

!
! Nonbonded Options [short distances and no pme just for image centering]
!

nbonds atom vatom vfswitch bycb -
       ctonnb 4.0 ctofnb 5.0 cutnb 6.0 cutim 6.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 !-       ewald pmew fftx @fftx ffty @ffty fftz @fftz  kappa .34 spline order 6
!energy


!
! Trajectory analysis (number of trajectory: @cntmax)
!

coor copy comp

open write unit 51 card name @local/hydro_thick_@sysname_@cntmin_@cntmax.plo

!set cntmin = 1
!calc cntmax = @ns

calc cnt     = @cntmin
calc unit    = 11

calc tcnt    = (@cnt-1)*100
set prnlev 0
label opentrj

   open read unit @unit file name ./namd/step7.@cnt.dcd
   traj query unit @unit
   calc start = ?start
   calc skip  = ?skip
   calc nfile = ?NFILE / 10

   !traj firstu 11 nunit 1 skip 500000 begin @start
   traj iread 11 nread 1 begin @start skip 50000

   calc cmt = 1
   label readtrj

      traj read

      calc time = @tcnt * 0.01  ! ns

      !centering 1
      coor stat mass sele ( ( segid MEMB ) .and. resid 9 ) end
      coor trans zdir -?zave
      energy

      !centering 2
      coor stat mass sele ( segid MEMB ) .and. .not. hydrogen end
      coor trans zdir -?zave
      energy

      define UPPER select ( (resn PGAR .or. resn ZWAR) .and. type C2) .and. -
                            prop z .gt. 0 show end
      define LOWER select (  (resn PGAR .or. resn ZWAR) .and. type C2) .and. -
                            prop z .lt. 0 show end

      coor stat sele UPPER end
      calc zupave = ?zave

      coor stat sele LOWER end
      calc zdnave = ?zave

      calc dist = @zupave - @zdnave

      !write title unit 51
      !* @time @dist
      !*

      write title unit 51
      * @cnt @dist
      *

      increase tcnt by 10
      increase cmt  by 1

   !if cmt .le. @nfile goto readtrj

   !debug
   !stop

   increase cnt   by 1
if cnt .le. @cntmax goto opentrj

stop
